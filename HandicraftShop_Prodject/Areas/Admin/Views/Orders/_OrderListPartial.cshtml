@model IEnumerable<BussinessObject.Order>

@if (Model == null || !Model.Any())
{
    <div class="text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted"></i>
        <h5 class="mt-3">No orders found</h5>
        <p class="text-secondary">Try adjusting your search filters.</p>
    </div>
}
else
{
    <div class="table-responsive shadow-sm rounded-3 bg-white">
        <table class="table align-middle table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Payment</th>
                    <th>Shipping</th>
                    <th>Staff</th>
                    <th style="width:160px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var order in Model)
                {
                    <tr id="order-@order.OrderId">
                        <td><strong>@order.OrderId</strong></td>
                        <td>@order.Customer?.FullName</td>
                        <td>@order.OrderDate?.ToString("dd/MM/yyyy")</td>
                        <td class="fw-bold text-success">$@order.TotalAmount?.ToString("N2")</td>
                        <td>
                            <span class="badge bg-@(order.PaymentStatus switch {
                                "Pending" => "warning text-dark",
                                "Paid" => "success",
                                "Refunded" => "secondary",
                                _ => "light text-dark"
                            })">
                                @order.PaymentStatus
                            </span>
                        </td>
                        <td>
                            <!-- Đảm bảo id cho badge để JS dễ update -->
                            <span id="ship-status-@order.OrderId" 
                                  class="badge bg-@(order.ShippingStatus switch {
                                      "Pending" => "warning text-dark",
                                      "Approved" => "info text-dark",
                                      "Delivered" => "success",
                                      "Cancelled" => "danger",
                                      _ => "secondary"
                                  })">
                                @order.ShippingStatus
                            </span>
                        </td>
                        <td>@order.Staff?.FullName</td>
                        <td>
                            <div class="d-flex gap-2">
                                <!-- View Details -->
                                <a asp-area="Admin" asp-controller="Orders" asp-action="Details"
                                   asp-route-id="@order.OrderId" class="btn btn-sm btn-outline-primary"
                                   title="View Details">
                                    <i class="bi bi-eye"></i>
                                </a>

                                <!-- Edit Order -->
                                <a asp-area="Admin" asp-controller="Orders" asp-action="Edit"
                                   asp-route-id="@order.OrderId" class="btn btn-sm btn-outline-secondary"
                                   title="Edit Order">
                                    <i class="bi bi-pencil"></i>
                                </a>

                                @if (order.ShippingStatus == "Pending")
                                {
                                    <button type="button" class="btn btn-sm btn-success btn-action"
                                            data-id="@order.OrderId" data-action="approve" title="Approve Order">
                                        <i class="bi bi-check2-circle"></i>
                                    </button>
                                
                                    <button type="button" class="btn btn-sm btn-danger btn-action"
                                            data-id="@order.OrderId" data-action="reject" title="Reject Order">
                                        <i class="bi bi-x-circle"></i>
                                    </button>
                                }
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
